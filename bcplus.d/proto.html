<!DOCTYPE html>
<html lang="de">
	<head>
   	<meta charset="utf-8">
   	<meta name="viewport" content="width=device-width, initial-scale=1.0">
   	<title>BC+ `version`: `title`</title>
    	<link rel="icon" href="s/img/logo.ico">
    	<link rel="stylesheet" href="s/css/bcp.css">
    	<script src="s/js/vue.js"></script>
  	</head>
  	<body>
  		<header id="hdr">
			<a href="/"><img id="bcplogo" src="s/img/Logo.png"></a>
  			<div id="switches">
				<img id="off" src="s/img/OnOff.png" title="Double-click to shutdown BC+" ondblclick="quit()">
				<div id="menu">
		  			<img src="s/img/Menu.png" onclick="showMenu()">
		  			<ul class="hide" onmouseleave="hideMenu()">
		    			<li><a href="set-macros" target="bcp-settings">Journal Event Macros</a></li>
		    			<li><a href="disconnect" title="Let's you connect from another machine">Disconnect</a></li>
		  	 			<li><a href="doc/index-en.html" target="bcp-doc">Documentation</a></li>
		  			</ul>
				</div>
			</div>
			<div id="base">
				<p>CMDR {{cmdr.name}}<p>
				<p title="Not precise because of share with crew member">~{{cmdr.creds.toLocaleString()}} Cr</p>
				<p>{{cship.name}} / {{cship.id}}</p>
				<p>{{cship.type}}</p>
			</div>
			<main-rank catnm="combat" v-bind:rank="ranks.combat"></main-rank>
			<main-rank catnm="trading" v-bind:rank="ranks.trade"></main-rank>
			<main-rank catnm="explorer" v-bind:rank="ranks.explor"></main-rank>
			<main-rank catnm="cqc" v-bind:rank="ranks.cqc"></main-rank>
			<div class="locinfo">
				<div style="text-align:center">
					<img class="inlico btn"
					     v-bind:src="'s/img/'+(isHome ? '' : 'not')+'Home.png'"
					     title="Toggle Home System"
			     		  onclick="tglHome()"><br>
		   		<img class="inlico btn"
		   		     v-bind:src="'s/img/'+(loc.isDest ? '' : 'no')+'Dest.png'"
		   		     title="Toggle Destination"
		        		  onclick="tglDest()">
				</div>&nbsp;
				<div><p>{{locTag}}</p><p>{{loc.coo[0].toLocaleString()}} /
				                         {{loc.coo[1].toLocaleString()}} /
				                         {{loc.coo[2].toLocaleString()}}</p></div>
				<div style="margin-left:1em;"><p>Home: {{homeTag}}</p><p>→ {{dist2home.toLocaleString(undefined,{maximumFractionDigits:1})}} Ly</p></div>
			</div>
			<pow-rank pownm="fed" v-bind:rank="ranks.fed"></pow-rank>
			<pow-rank pownm="imp" v-bind:rank="ranks.imp"></pow-rank>
  		</header>
  		<script>
const theRanks = {
	combat: { name: "Combat",
				 level: ["Harmless","Mostly Harmless","Novice","Competent",
				 			"Expert","Master","Dangerous","Deadly","Elite"]
			  },
	trading: { name: "Trading",
				  level: ["Penniless","Mostly Penniless","Peddler","Dealer",
							 "Merchant","Broker","Entrepreneur","Tycoon","Elite"]
			   },
	explorer: { name: "Explorer",
				   level: ["Aimless","Mostly Aimless","Scout","Surveyor",
					        "Trailblazer","Pathfinder","Ranger","Pioneer","Elite"]
				 },
	cqc: { name: "CQC",
			 level: ["Helpless","Mostly Helpless","Amateur","Semi Professional",
						"Professional","Champion","Hero","Legend","Elite"]
		  },
	fed: { name: "Federation",
			 level: ["None","Recruit","Cadet","Midshipman","Petty Officer","Chief Petty Officer",
			"Warrant Officer","Ensign","Lieutenant","Lieutenant Commander","Post Commander",
			"Post Captain","Rear Admiral","Vice Admiral","Admiral"]
		  },
	imp: { name: "Empire",
	       level: ["None","Outsider","Serf","Master","Squire","Knight","Lord","Baron","Viscount",
			"Count","Earl","Marquis","Duke","Prince","King",]
		  },
	// Make it a vue plugin ?!
	install: function(){
  		Object.defineProperty(Vue.prototype, '$theRanks', {
    		get () { return shared }
  		})
  	}
};
Vue.use(theRanks);

function locTag(loc) {
	if (!loc) {
		return "–";
	} else if (loc.port) {
		return loc.port + " / " + loc.sys;
	} else if (loc.body) {
		var res = loc.sys + " - " + loc.body;
		if (loc.spot) {
			res += " @"+loc.spot.lat+";"+loc.spot.long;
		}
		return res; 
	} else {
		return loc.sys; 
	}	
}

Vue.component('main-rank', {
	props: ['catnm', 'rank'],
	computed: {
		catg: function () { return theRanks[this.catnm]; },
		rmax: function () { return this.catg.level.length - 1; },
		next: function () {
			var sub = this.catg.level.slice(0, this.rank.level);
			var res = sub.join("\n");
			res += "\n> "+this.catg.level[this.rank.level]+" <\n";
			sub = this.catg.level.slice(this.rank.level + 1);
			res += sub.join("\n");				 
			return res;
		}
	},
	template: `
<div class="rank">
	<img class="logo" v-bind:src="'s/rnk/'+catnm+'/'+rank.level+'.png'" v-bind:title="catg.name">
	<div>
		<p v-bind:title="next">{{catg.level[rank.level]}}</p>
		<p>{{rank.level}}/{{rmax}} +{{rank.prgs}}%</p>
	</div>
</div>`
});
  	
Vue.component('pow-rank', {
	props: ['pownm', 'rank'],
	computed: {
		powr: function () { return theRanks[this.pownm] },
		rmax: function () { return this.powr.level.length - 1; },
		next: function () {
			var sub = this.powr.level.slice(0, this.rank.level);
			var res = sub.join("\n");
			res += "\n> "+this.powr.level[this.rank.level]+" <\n";
			sub = this.powr.level.slice(this.rank.level + 1);
			res += sub.join("\n");
			return res;
		}
	},
	template: `
<div class="rank">
	<img class="logo" v-bind:src="'s/fctn/'+pownm+'s.png'" v-bin:alt="pownm" v-bind:title="powr.name">
	<div>
		<p v-bind:title="next">{{powr.level[rank.level]}}
		<p>{{rank.level}}/{{rmax}} +{{rank.prgs}}%</p></div>
</div>`
});  	
  	
var hdr = new Vue({
	el: '#hdr',
	data: {  
		cmdr: { name: "Jameson", creds: 1234 },
		loc: {
			coo: [123, 4567, 89],
		 	sys: "Shinratha",
		 	body: "B3",
		 	spot: {lat: 12.34, long: 56.78}
		 	/*isDest: true*/
		},
		home: {
			coo: [0, 0, 0],
			sys: "Sol",
			port: "Mars High"
		},
		ranks: {
			combat: { level: 6, prgs: 20 },
			trade: { level: 7, prgs: 17 },
			explor: { level: 8, prgs: 100 },
			cqc: { level: 0, prgs: 2 },
			fed: { level: 7, prgs: 25 },
			imp: { level: 8, prgs: 78 }
		},
		cship: { type: "ASPx", id: "JV-AX1", name: "Nugget" }
	},
	computed: {
		locTag: function () { return locTag(this.loc); },
		homeTag: function () { return locTag(this.home); },
		dist2home: function () {
			if (this.loc.coo && this.home.coo) {
				var dx = this.loc.coo[0] - this.home.coo[0];
				var dy = this.loc.coo[1] - this.home.coo[1];
				var dz = this.loc.coo[2] - this.home.coo[2];
				return Math.sqrt(dx*dx+dy*dy+dz*dz); 
			} else {
				return "–";
			}			 	
		},
		isHome: function () {
			if (!this.loc || !this.home) { return false; }		
			return locTag(this.loc) == locTag(this.home)
		}
	}
});
	  	</script>
  	</body>
</html>
